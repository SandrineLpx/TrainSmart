# Iteration 1 - 2026-02-09 (Initial Build)

## Historical note
This log captures the state on 2026-02-09. References to A/B/C and `training_log.json` are historical, not current architecture.

## What was built

### Data Layer
- **`scripts/parse_excel.py`** — Parses `Leg Drive.xlsx` (8 sheets) into `data/program.json`. Handles all 5 days (Mon–Fri), mixed data types in sets/reps columns.
- **`data/program.json`** — Structured JSON: 8 weeks, 5 days each, odd/even patterns, volume tapering (6→4→3 sets).
- **`data/training_log.json`** — Seeded with 4 sample entries (Week 1: A, B, cardio, C).
- **`data/preferences.json`** — Kirkland WA coordinates, outdoor thresholds (rain <40%, temp >40°F, wind <25mph).

### MCP Servers (2)
- **`mcp_servers/weather_mcp.py`** — Open-Meteo API, no key needed. Returns 7-day forecast with `outdoor_suitable` flag. Tested and working.
- **`mcp_servers/strava_mcp.py`** — Strava API v3 with OAuth2 token refresh. Returns recent activities (name, type, distance, duration, date).
- **`scripts/strava_auth.py`** — One-time OAuth helper: opens browser, catches redirect on localhost:8484, saves tokens.

### Skills (3) — redesigned mid-iteration for better UX
- **`/weekly-plan`** — Start-of-week planner. Asks how many days, gathers all data (log, program, weather, Strava), builds schedule, saves to `data/current_week_plan.json`.
- **`/checkin`** — Quick pre-workout confirmation (~10 sec). Reads weekly plan, asks 3 questions (sleep, soreness, energy), confirms or adjusts today's session.
- **`/log-session`** — Records completed sessions. Compares to prescription, flags skipped exercises, appends to training_log.json.

### Config
- **`CLAUDE.md`** — Project memory: athlete profile, A/B/C system, decision rules, stop rules, file paths.
- **`.mcp.json`** — MCP server registration for Claude Code (Windows paths with `.venv`).
- **`.gitignore`** — Protects `data/strava_config.json` from being shared.

## Issues encountered & fixes

| Issue | Fix |
|-------|-----|
| SSL certificate error on Windows when calling Strava API | Added `certifi`-based SSL context to both `strava_auth.py` and `strava_mcp.py` |
| Strava MCP crashes if user hasn't configured credentials | Added `_is_configured()` check — returns friendly "not configured" message instead of error |
| Skills didn't handle unconfigured Strava gracefully | Updated `/checkin` and `/weekly-plan` to detect `"status": "not_configured"` and fall back to manual cardio input |

## Prompt iteration 1: Strava fallback (before/after)

**Before (v1):**
> "If the Strava MCP fails (not configured), skip this step and ask the athlete: 'Any cardio in the last 48 hours?'"

**After (v2):**
> "If the response contains `"status": "not_configured"`: Strava is not connected. Ask the athlete: 'Strava is not connected. Would you like to connect it? (Run `python scripts/strava_auth.py` to set up.) For now, any cardio in the last 48 hours?'"

**Why:** v1 silently skipped Strava. v2 tells the user Strava exists, how to connect it, and still works without it. Better onboarding for new users.

## Prompt iteration 2: Skill UX redesign — /checkin and /weekly-plan

### Problem
The original `/checkin` skill asked 5+ questions every single time (time, sleep, soreness, energy, competition, etc.), gathered all data from scratch (program, log, weather, Strava), and ran the full decision engine. This was too slow and repetitive for a pre-workout check-in.

### Before (v1): /checkin did everything
> `/checkin` asked 5 questions, read program + log, called weather + Strava, ran full session selection logic, and produced a recommendation. Every session felt like a planning session.

### After (v2): Two-phase workflow
> **`/weekly-plan`** (once per week): Asks how many WL days, busy days, cardio preference, fatigue, competition. Gathers all data (log, program, weather, Strava) in parallel. Builds a day-by-day schedule and saves it to `data/current_week_plan.json`.
>
> **`/checkin`** (before each session): Reads the saved weekly plan. Asks only 3 questions: sleep quality, soreness (0-10), energy (1-5). Confirms today's planned session or adjusts it based on readiness. Takes ~10 seconds.

### Key design changes
- New file: `data/current_week_plan.json` — persists the weekly schedule between sessions
- `/checkin` has a decision table for when to switch sessions (e.g., soreness 7+ → downgrade to B or mini)
- `/checkin` has a fallback mode if no weekly plan exists (runs simplified full logic)
- Session priority order preserved: B → A → C

**Why:** The athlete wants convenience. Planning happens once; daily confirmation should be near-instant. Separating planning from execution matches real behavior — you decide your week on Sunday, then just show up and train.

## File structure after this iteration

```
Training_App/
├── .claude/skills/checkin/SKILL.md
├── .claude/skills/log-session/SKILL.md
├── .claude/skills/weekly-plan/SKILL.md
├── .mcp.json
├── .gitignore
├── CLAUDE.md
├── data/
│   ├── program.json
│   ├── training_log.json
│   ├── current_week_plan.json (created by /weekly-plan, read by /checkin)
│   ├── preferences.json
│   ├── strava_config.json (gitignored)
│   └── strava_config.template.json (ships empty)
├── mcp_servers/
│   ├── weather_mcp.py
│   └── strava_mcp.py
├── scripts/
│   ├── parse_excel.py
│   └── strava_auth.py
├── references/
│   ├── training_skills_ABC_v1.md (archived original)
│   ├── Leg Drive.xlsx (source program)
│   └── MSIS549_HW2_Agentic_AI.docx.md (assignment)
├── iterations/
│   └── iteration_01_2026-02-09.md (this file)
└── iterations/
```

## Next steps
- Test `/checkin` end-to-end in a live Claude Code session
- Test `/log-session` to verify JSON append works
- Test `/weekly-plan` with real weather + Strava data
- Run benchmark scenarios (7 test cases)
- Write tutorial PDF + record demo video